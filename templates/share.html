{% extends "base.html" %}
{% block content %}

<h3>{{ share_title or "Shared set" }}</h3>
<p class="mini">
  Share link token: <span class="badge">{{ token }}</span>
  ·
  <a href="{{ toggle_plots_url }}">{% if show_plots %}Hide plots{% else %}Show plots{% endif %}</a>
</p>

{% if movies %}
  <div class="grid">
    {% for m in movies %}
      <div class="card">
        {% if m.poster_path %}
          <a href="{{ url_for('movie', tmdb_id=m.tmdb_id) }}">
            <img class="poster" loading="lazy"
                 src="{{ url_for('poster', size='w342', tmdb_id=m.tmdb_id) }}"
                 alt="Poster for {{ m.title }}">
          </a>
        {% endif %}
        <p style="margin:8px 0 4px 0;"><b>{{ m.title }}</b></p>
        <p class="mini" style="margin:0;">
          {{ m.year or "—" }} · ★ {{ "%.1f"|format(m.vote_avg or 0) }} ({{ m.vote_count or 0 }})
        </p>
        {% if show_plots and m.overview %}
        <p class="mini" style="margin:8px 0; line-height:1.4;">
          {{ m.overview }}
        </p>
        {% endif %}
        <p class="mini" style="margin:4px 0 0 0;">
          <a href="https://www.justwatch.com/us/search?q={{ m.title|urlencode }}" target="_blank" rel="noopener">JustWatch</a>
          ·
          <a href="http://nas.phfactor.net:8310/add/new?term={{ m.title|urlencode }}" target="_blank" rel="noopener">Local</a>
        </p>
      </div>
    {% endfor %}
  </div>

  <form method="post" action="{{ url_for('share_fork', token=token) }}" style="margin-top:14px;">
    <input type="hidden" name="csrf" value="{{ csrf_token }}">
    <button type="submit">Add all to my basket (fork)</button>
  </form>
{% else %}
  <p>No movies in this share link.</p>
{% endif %}

{% endblock %}
